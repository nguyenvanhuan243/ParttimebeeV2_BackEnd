
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Search result page</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <%= stylesheet_link_tag 'home/bootstrap.min'%>
    <%= stylesheet_link_tag 'home/flexslider' %>
    <%= stylesheet_link_tag 'home/bootstrap-slider.min' %>
    <%= stylesheet_link_tag 'home/select-style' %>
    <%= stylesheet_link_tag 'home/style' %>
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="images/favicon.ico" type="image/x-icon">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <meta name="description" content='Search result page'/>
  <link href="https://www.stacreatewebsite.com/demo/parttimebeenew/css/responsive.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lato:300i,400,900|Montserrat:400,700" rel="stylesheet">
</head>
<body class="job-listing">

  <div class="wapper">
    
    <%= render 'layouts/header'%>

    <div class="all-jobs">
      
      <div class="auto-container box-all-jobs">
                <div class="container">
            <h1>Show me <a class="l-search-jobs-keyword" href="#">
            <% if params[:category].blank?%>
              <%= $get_search_job%>
            <% else %>
              <%= params[:category]%>
            <% end %>
              <i class="fa fa-times close-keyword" aria-hidden="true"></i></a> jobs in <a class="l-search-jobs" href="#">
            <% if params[:state].blank? %>
              Malaysia
            <% else %>
              <%= params[:state]%>
            <% end %> 
             <i class="fa fa-angle-down" aria-hidden="true"></i></a></h1> 
                    <div class="advanced">
                        <a class="btn-click" href="#">Advanced</a> 
                        <div class="hideshow">
                            <%= form_for(:searchdate, html: {:multipart => true}, :url => {:controller => 'search', :action => 'search_date'}) do |f| %>
                              <div class="form-group" style="margin-bottom: 16px;">
                                <label style="margin-bottom: 1px;">Slot at least<span id="ex6SliderVal">10</span></label>
                                <input id="ex1" data-slider-id='ex1Slider' type="text" data-slider-min="1" data-slider-max="100" data-slider-step="1" data-slider-value="10"/>
                              </div>
                              <div class="form-group working-date">
                                <div class="row">
                                    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                        <label>Working Date from</label>
                                        <%= f.text_field :workingdatefrom, :class=>"form-control", :id=> 'datetimepicker4', :placeholder => 'Select Date'%> 
                                    </div>
                                    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                        <label>Working Date to</label>
                                        <%= f.text_field :workingdateto, :class=>"form-control", :id=> 'datetimepicker5', :placeholder => 'Select Date'%>  
                                    </div>
                                </div>
                                <br>
                                <div class="row">
                                  <button class="btn btn-primary">
                                    Apply
                                  </button>
                                </div>
                              </div>
                            <% end %>
                        </div><!-- hideshow -->
                    </div><!-- advanced --> 
                </div>
      </div><!-- box-search-result -->

    </div><!-- .All Jobs -->

    <div class="content">
      <div class="container">
      <% @jobs = $check_result_jobs %>
      <% if params[:slot].nil?%>
          <% unless params[:category].blank? %>
            <% @jobs = $check_result_jobs.where(category_job: params[:category]).all%>
          <% end %>
          <% unless params[:state].blank? %>
            <% @jobs = @jobs.where(state: params[:state]).all%>
          <% end %> 
        <% else %>
          <% if params[:category].blank? %>
            <% @jobs = $check_result_jobs.where("vacancies>=?", params[:slot]).all %>
          <% else %>
            <% @jobs = $check_result_jobs.where(category_job: $get_category_job).where("vacancies>=?", 1).all%>
          <% end %>
          <% unless params[:state] %>
            <% @jobs = @jobs.where(state: $get_state_job).where("vacancies>=?", 1).all%>
          <% end %> 
        <%end%>

        <% unless params[:datefrom].blank? %>
          <% unless params[:dateto].blank? %>
            <% if $get_category_job == nil %>
              <% @jobs = $check_result_jobs.where("working_date_from>=?", Date.strptime(params[:datefrom], '%m/%d/%Y')).where("working_date_to<=?", Date.strptime(params[:dateto], '%m/%d/%Y')).all %>
            <% else %>
              <% @jobs = $check_result_jobs.where(category_job: $get_category_job).where("working_date_from>=?", Date.strptime(params[:datefrom], '%m/%d/%Y')).where("working_date_to<=?", Date.strptime(params[:dateto], '%m/%d/%Y')).all %>
            <% end %>
            <% if $get_state_job != nil %>
              <% @jobs = @jobs.where(state: $get_state_job).where("working_date_from>=?", Date.strptime(params[:datefrom], '%m/%d/%Y')).where("working_date_to<=?", Date.strptime(params[:dateto], '%m/%d/%Y')).all%>
            <% end %> 
          <% end %>
        <% end %>
      <% @jobs_search = @jobs.paginate(:per_page => 10, :page => params[:page]) %>
        <% @jobs_search.each do |job|%>
                <div class="item">
            <div class="item-thumbnail">
              <a href="#" title="Thumbnail" class='thumbnail-image'>
                <%= image_tag "blank-image.png", alt: "Thumbnail"%>
              </a>  
            </div><!-- .item-thumbnail -->
            <div class="item-info">
              <h2 class="title"><a href="/job-details/<%=job.id%>" title="Front-end Developer"><%= job[:title] %></a></h2>
              <div class="option">
                <div class="item-note"> 
                  <div class="promotion-flags">
                    <a href="#" class="btn btn-spot" title="On The Spot">On The Spot</a>
                    <a href="#" class="btn btn-commission" title="Commission">Commission</a>
                  </div><!-- .promotion-flags -->
                </div>
                <div class="tag-location">
                  <div class="tag-link">  
                    <a href="#" title="Technology">
                      <%= job[:category_job]%>
                    </a>
                  </div>
                  <div class="location-link">
                    <a href="#" title="Petaling Jaya">
                      <%= job[:state]%>
                    </a>
                  </div>
                </div><!-- .tag-location -->
                <div class="time-work">
                  <span>Working period: <span class="month">1 Jun - 30 Jun</span></span>
                  <p><span class="month">100</span> vacancies available</p>
                </div><!-- .time-work -->
              </div><!-- .option -->
            </div><!-- .box-content -->
            <div class="item-price-box">
              <div class="right-box-3">
                <div class="clock">
                <% @get_hour = Time.now.hour - job[:created_at].hour %>
                  <% @get_min = Time.now.min - job[:created_at].min%>
                    <% if @get_hour < 1 %>
                      <span class="time-add pull-right"><%=@get_min.to_i.abs%> minutes ago</span>
                    <% end %>
                    <% if @get_hour > 1 %>
                      <span class="time-add pull-right"><%=@get_hour.to_i.abs%> hours ago</span>
                    <% end %>       
                </div><!-- .clock -->
                <div class="cost">
                <% if current_user == nil%>
                    <a href="/login" class="fa fa-heart like-btn pull-right" aria-hidden="true"></a>
                  <% else %>
                    <% if Favoritejob.where(job_id: job.id, parttimer_id: current_user.id).count.positive? %>
                      <%= link_to "",{controller: "job", action: "click_favorite_job_again", id: job[:id] }, class: "fa fa-heart like-btn-clicked pull-right" %>
                    <% else %>
                      <%= link_to "",{controller: "job", action: "click_favorite_job", id: job[:id] }, class: "fa fa-heart like-btn pull-right" %>
                    <% end %>
                  <% end %>
                  <div class="share pull-right">
                                 <a class="share-click" href="#"><i class="fa fa-share-alt" aria-hidden="true"></i></a>
                                        <div id="foo" class="icon-share" style="display: none; height: 100px; padding-top: 0px; margin-top: 0px; padding-bottom: 15px; margin-bottom: 0px;">
                                            <p>Share</p>
                                            <ul>
                                                <li>
                                                <a href="https://www.facebook.com/sharer.php?u=parttimebee.my/job-details/<%= job[:id]%>"><i class="fa fa-facebook" aria-hidden="true"></i>
                                                </a>
                                              </li>
                                              <li>
                                                <a href="http://twitter.com/share?text=&url=http://parttimebee.my/job-details/<%= job[:id]%>"><i class="fa fa-twitter" aria-hidden="true"></i>
                                                </a>
                                              </li>
                                              <li>
                                                <a href="https://plus.google.com/share?url=http%3A//www.parttimebee.my/job-details/<%= job[:id]%>">
                                                  <i class="fa fa-google-plus" aria-hidden="true"></i>
                                                </a>
                                              </li>
                                            </ul>
                                        </div>
                                    </div>
                  <span class="price pull-right">RM<%= job.salary%>/<%=job[:per_day]%></span> 
                </div><!-- .cost -->
              </div><!-- right-box-3 -->
            </div><!-- .box-content -->
        </div><!-- .item -->
        <% end %>
        <div class="page-nav">        
          <nav aria-label="Page navigation">
              <% if @jobs.count > 10%>
                <ul class="pagination pagination-lg">
                    <li class="sub-page-nav">
                      <a href="#" aria-label="Previous">
                          <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                    <% for i in 1..(@jobs.count/10.to_f).ceil  %>
                      <li><a href="/search-jobs-found?page=<%=i%>"><%=i%></a></li>
                  <% end %>
                  <li class="sub-page-nav">
                        <a href="#" aria-label="Next">
                          <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                </ul>
              <% end %>
          </nav>
        </div><!-- page-nav -->
 
      </div><!-- .container -->

    </div><!-- .content -->
    <%= render "layouts/footer"%>
  </div><!-- wapper -->
<div class="search-jobs-selection" id="categories_list">
    <div class="search-list">
        <ul>
          <% Category.all.each do |c|%>
            <% if c.id >= 2 %>          
              <li>
                 <a href="?search=<%= params[:search]%>&category=<%= c.category_job%>&state=<%=params[:state]%>"><%= c.category_job%></a>
              </li>
            <% end %>
          <% end %>
        </ul>
    </div>
  <div class="click-hide"></div>
</div><!-- search-jobs -->
<div class="search-jobs-selection" id="coutry_list">
    <div class="search-list">
        <ul>
          <% State.all.each do |c|%>
            <% if c.id >= 2 %>  
              <li>
                 <a href="?search=<%= params[:search]%>&category=<%= params[:category]%>&state=<%=c.state%>"><%= c.state%></a>
              </li>
            <% end %>
          <% end %>
        </ul>
    </div>
    <div class="click-hide"></div>
</div><!-- search-jobs -->


<%= javascript_include_tag "home/jquery"%>
<%= javascript_include_tag "home/bootstrap.min"%>
<%= javascript_include_tag "home/jquery.flexslider"%>
<%= javascript_include_tag "home/wave"%>
<%= javascript_include_tag "home/moment"%>
<%= javascript_include_tag "home/bootstrap-datetimepicker"%>
<%= javascript_include_tag "home/bootstrap-slider"%>
<%= javascript_include_tag "home/jquery.nice-select.min"%>
<%= javascript_include_tag "home/parttimebee-custom"%>
<script type="text/javascript">
  $("#ex1").change(function(){
    window.location.reload(true);
    var url = window.location.origin + "/search-jobs-found";
    window.location.href = url + "?slot=" + $("#ex1").data('value') ;
  });
</script>
<script>
jQuery(document).ready(function(){
jQuery('#datetimepicker4').datetimepicker({ 
                format: 'MM/DD/YYYY'
            });
jQuery('#datetimepicker5').datetimepicker({ 
              format: 'MM/DD/YYYY'
            });
    jQuery('.btn-click').click(function(){    
         jQuery('.hideshow').toggle(500); 
         return false;    
    });
     jQuery(".share-click").click(function(){
            
        jQuery(".icon-share").stop().slideUp(300); 
        jQuery(this).next(".icon-share").stop().slideToggle(300);     
        return false;
    });
    jQuery("body").click (function(){
      // Close all open windows
      jQuery(".icon-share").stop().slideUp(300); 
    });
    jQuery(".l-search-jobs").click(function(){        
        jQuery('#coutry_list').show(300);  
        return false;
    });
    jQuery('.l-search-jobs-keyword').click(function(){
      jQuery(this).empty().html('All <i class="fa fa-angle-down" aria-hidden="true"></i>');
       jQuery('#categories_list').show(300);  
        return false;
    });
    jQuery(".click-hide").click(function(){        
        jQuery('.search-jobs-selection').hide(300);  
        return false;
    });
    jQuery("#ex1").slider();
        jQuery("#ex1").on("slide", function(slideEvt) {
  jQuery("#ex6SliderVal").text(slideEvt.value);
    });
    jQuery(document).ready(function() {
      jQuery('select:not(.ignore)').niceSelect();      
      //FastClick.attach(document.body);
    });  
});
</script>
</body><!-- .search-result-page -->
</html>